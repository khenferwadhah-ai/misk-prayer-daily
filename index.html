<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة مواقيت الصلاة</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Tahoma',Arial;}
body{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:url("background.jpg") no-repeat center center fixed;
  background-size:cover;
}
.overlay{
  width:95%;
  max-width:420px;
  background:rgba(0,0,0,0.72);
  border-radius:18px;
  padding:15px;
  text-align:center;
  color:white;
}
.logo{width:85px;margin-bottom:6px;}

/* العنوان بخط Kaf Gulzar Mo BOLD أبيض مع توهج ثلاثي الأبعاد */
.title{
  font-family: "Kaf Gulzar Mo", sans-serif;
  color: #ffffff;
  font-weight: bold;
  text-shadow: 
    2px 2px 4px #000000,
    0 0 6px #ffffff,
    0 0 12px #ffffff;
  margin:6px 0;
}

/* التاريخ الميلادي والهجري */
.date{
  font-family:'Amiri', serif;
  color:#bfff00;
  font-weight:bold;
  text-shadow:2px 2px 4px #006600,0 0 8px #bfff00,0 0 15px #80ff00;
  margin:6px 0;
}

/* الساعة الرقمية */
.clock{
  font-size:48px;
  font-weight:bold;
  margin:10px 0;
  padding:10px 20px;
  border-radius:12px;
  background:rgba(0,255,0,0.15);
  border:2px solid rgba(0,255,0,0.4);
  box-shadow: 0 0 20px rgba(0,255,0,0.6), 0 0 40px rgba(0,255,0,0.3) inset;
  color:#bfff00;
  text-shadow: 0 0 8px #bfff00, 0 0 15px #80ff00;
}

/* العد التنازلي للصلاة القادمة */
.next-prayer-display{
  font-family:'Amiri', serif;
  font-size:18px;
  font-weight:bold;
  color:#ffffff;
  text-shadow:2px 2px 4px #000000,0 0 6px #ffffff,0 0 12px #ffffff;
  margin:8px 0;
}

/* تلوين الصلاة القادمة في الجدول */
.next-prayer{
  color:#bfff00;
  font-weight:bold;
  text-shadow:0 0 6px rgba(191,255,0,0.6);
}

.table{width:100%;font-size:17px;}
.row{display:flex;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.25);padding:6px 0;}
</style>
</head>
<body>
<div class="overlay">

<img src="logo.png" class="logo">

<div class="title">الجمعية الخيرية مسك الختام – القرارم قوقة</div>

<div class="date" id="gregorian">--</div>
<div class="date" id="hijri">--</div>

<div class="clock" id="clock">00:00:00</div>
<div class="next-prayer-display" id="nextPrayerDisplay">--</div>

<div class="table" id="prayerTable">
<!-- جدول المواقيت سيتم ملؤه من times.json -->
</div>

</div>

<script>
// قراءة مواقيت الصلاة
fetch("times.json")
  .then(r => r.json())
  .then(data => {
    const prayers = data.prayers;
    const container = document.getElementById("prayerTable");

    prayers.forEach(p => {
      const div = document.createElement("div");
      div.className = "row";
      div.innerHTML = `<span>${p.name}</span><span>${p.time}</span>`;
      container.appendChild(div);
    });

    function updateClockAndCountdown(){
      const now = new Date();

      // الساعة الرقمية
      document.getElementById("clock").innerText = now.toLocaleTimeString("ar-DZ",{hour12:false});

      // التاريخ الميلادي
      document.getElementById("gregorian").innerText = now.toLocaleDateString("ar-DZ",{
        weekday:"long", year:"numeric", month:"long", day:"numeric"
      });

      // التاريخ الهجري المثبت حتى 01 فيفري 2026
      const cutoff = new Date("2026-02-01T00:00:00");
      let hijriDate;
      if(now < cutoff){
          hijriDate = "12 شعبان 1447";
      }else{
          hijriDate = now.toLocaleDateString('ar-SA-u-ca-islamic', {day:'numeric', month:'long', year:'numeric'});
      }
      document.getElementById("hijri").innerText = hijriDate;

      // العد التنازلي للصلاة القادمة
      let currentMinutes = now.getHours()*60 + now.getMinutes();
      let next = null;
      let nextTime = null;

      for(let p of prayers){
        if(p.name === "الإمساك") continue;
        let [h,m] = p.time.split(":").map(Number);
        let total = h*60 + m;
        if(total > currentMinutes){
          next = p;
          nextTime = total;
          break;
        }
      }

      if(!next){
        next = prayers.find(p => p.name !== "الإمساك") || prayers[0];
        let [h,m] = next.time.split(":").map(Number);
        nextTime = h*60 + m + (24*60 - currentMinutes);
      }

      let diffMinutes = nextTime - currentMinutes;
      let hrs = Math.floor(diffMinutes/60);
      let mins = diffMinutes % 60;
      let secs = 60 - now.getSeconds();
      if(secs === 60){ secs = 0; mins++; if(mins===60){mins=0;hrs++;} }

      document.getElementById("nextPrayerDisplay").innerText =
        `الصلاة القادمة: ${next.name} بعد ${hrs}س ${mins}د ${secs}ث`;
    }

    setInterval(updateClockAndCountdown,1000);
    updateClockAndCountdown();

    // تلوين الصلاة القادمة
    function colorNextPrayer(){
      const rows = document.querySelectorAll(".row");
      const now = new Date();
      const currentMinutes = now.getHours()*60 + now.getMinutes();
      rows.forEach(r => r.classList.remove("next-prayer"));

      for(let row of rows){
        const name = row.children[0].innerText.trim();
        const time = row.children[1].innerText.trim();
        if(name === "الإمساك") continue;
        const [h,m] = time.split(":").map(Number);
        const total = h*60 + m;
        if(total > currentMinutes){
          row.classList.add("next-prayer");
          break;
        }
      }
    }

    setInterval(colorNextPrayer,30000);
    colorNextPrayer();

  })
  .catch(err=>console.error("خطأ في تحميل مواقيت الصلاة:", err));
</script>
</body>
</html>