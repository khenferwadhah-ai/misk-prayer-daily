<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة مواقيت الصلاة</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Tahoma',Arial;}
body{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:url("background.jpg") no-repeat center center fixed;
background-size:cover;
}
.overlay{
width:95%;
max-width:420px;
background:rgba(0,0,0,0.72);
border-radius:18px;
padding:15px;
text-align:center;
color:white;
}
.logo{width:85px;margin-bottom:6px;}
.title{font-size:18px;font-weight:bold;}
.date{font-size:14px;margin:6px 0;color:#ffd700;}
.clock{font-size:38px;font-weight:bold;margin:6px 0;}
.next{font-size:16px;margin:8px 0;color:#00ffd5;}
.table{width:100%;font-size:17px;}
.row{display:flex;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.25);padding:6px 0;}
</style>
</head>

<body>

<div class="overlay">

<img src="logo.png" class="logo">

<div class="title">الجمعية الخيرية مسك الختام – الڨرارم ڨوڨة</div>

<div class="date" id="gregorian">--</div>
<div class="date" id="hijri">--</div>

<div class="clock" id="clock">00:00:00</div>
<div class="next" id="countdown">--</div>

<div class="table" id="prayerTable">
<!-- جدول المواقيت سيتم ملؤه من times.json -->
</div>

</div>

<script>
// قراءة مواقيت الصلاة
fetch("times.json")
  .then(r => r.json())
  .then(data => {
    const prayers = data.prayers;
    const container = document.getElementById("prayerTable");

    prayers.forEach(p => {
      const div = document.createElement("div");
      div.className = "row";
      div.innerHTML = `<span>${p.name}</span><span>${p.time}</span>`;
      container.appendChild(div);
    });

    function updateCountdown(){
      const now = new Date();
      document.getElementById("clock").innerText = now.toLocaleTimeString("ar-DZ");
      document.getElementById("gregorian").innerText = now.toLocaleDateString("ar-DZ",{
        weekday:"long", year:"numeric", month:"long", day:"numeric"
      });

      // التاريخ الهجري المثبت حتى 01 فيفري 2026 الساعة 00:00
const cutoff = new Date("2026-02-01T00:00:00"); // تاريخ الحد
let hijriDate;

if(now < cutoff){
    hijriDate = "12 شعبان 1447"; // التاريخ المثبت
}else{
    hijriDate = now.toLocaleDateString('ar-SA-u-ca-islamic', {day:'numeric', month:'long', year:'numeric'});
}

document.getElementById("hijri").innerText = hijriDate;

      let currentMinutes = now.getHours()*60 + now.getMinutes();
      let next = null;
      let diffMin = null;

      for(let p of prayers){
        if(p.name === "الإمساك") continue; // تجاهل الإمساك في العدّ التنازلي
        let [ph,pm] = p.time.split(":");
        let total = parseInt(ph)*60 + parseInt(pm);
        if(total > currentMinutes){
          next = p;
          diffMin = total - currentMinutes;
          break;
        }
      }

      if(!next){ // إذا انتهت كل الصلوات، اختر أول صلاة بعد الإمساك
        next = prayers.find(p => p.name !== "الإمساك") || prayers[0];
        let [ph,pm] = next.time.split(":");
        let total = parseInt(ph)*60 + parseInt(pm) + (24*60-currentMinutes);
        diffMin = total;
      }

      const hrs = Math.floor(diffMin/60);
      const mins = diffMin % 60;
      document.getElementById("countdown").innerText =
        "الصلاة القادمة: "+next.name+" بعد "+hrs+"س "+mins+"د";
    }

    setInterval(updateCountdown,1000);
    updateCountdown();
  })
  .catch(err=>console.error("خطأ في تحميل مواقيت الصلاة:", err));
</script>

</body>
</html>
